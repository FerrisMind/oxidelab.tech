const fs = require("fs");
const path = require("path");
const { execSync } = require("child_process");

console.log("üöÄ –ù–∞—á–∏–Ω–∞—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É —Å–∞–π—Ç–∞ –∫ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥...\n");

try {
  // 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  console.log("üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏...");
  execSync("npm install", { stdio: "inherit" });

  // 2. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
  console.log("\nüî® –°–æ–±–∏—Ä–∞—é –ø—Ä–æ–µ–∫—Ç...");
  execSync("npm run build", { stdio: "inherit" });

  // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–∞–ø–∫–∏ out
  const outDir = path.join(__dirname, "out");
  if (!fs.existsSync(outDir)) {
    throw new Error("–ü–∞–ø–∫–∞ out –Ω–µ –Ω–∞–π–¥–µ–Ω–∞! –°–±–æ—Ä–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å.");
  }

  // 4. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .htaccess –≤ –ø–∞–ø–∫—É out
  const htaccessSource = path.join(__dirname, "public", ".htaccess");
  const htaccessDest = path.join(outDir, ".htaccess");

  if (fs.existsSync(htaccessSource)) {
    fs.copyFileSync(htaccessSource, htaccessDest);
    console.log("‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω .htaccess —Ñ–∞–π–ª");
  }

  // 5. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–≥—Ä—É–∑–∫–µ
  const instructions = `
# üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥

## –ß—Ç–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å:
–ó–∞–≥—Ä—É–∑–∏—Ç–µ –í–°–ï —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ 'out/' –≤ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏:
out/
‚îú‚îÄ‚îÄ index.html          ‚Üê –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îú‚îÄ‚îÄ .htaccess          ‚Üê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ _next/             ‚Üê –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã Next.js
‚îú‚îÄ‚îÄ static/            ‚Üê –í–∞—à–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ ...–¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã

## –®–∞–≥–∏:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∏–Ω–≥–æ–º
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ñ–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
3. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ (–æ–±—ã—á–Ω–æ public_html/ –∏–ª–∏ www/)
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –í–°–ï —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ 'out/'
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ index.html –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –¥–æ–º–µ–Ω–∞

## –ü—Ä–æ–≤–µ—Ä–∫–∞:
- –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

## –ì–æ—Ç–æ–≤–æ! üéâ
–í–∞—à —Å–∞–π—Ç –≥–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥.
`;

  fs.writeFileSync(
    path.join(__dirname, "–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–ó–ê–ì–†–£–ó–ö–ò.txt"),
    instructions
  );

  console.log("\n‚úÖ –ì–æ—Ç–æ–≤–æ! –°–∞–π—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –∫ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥.");
  console.log("\nüìÅ –ü–∞–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏: out/");
  console.log("üìÑ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ñ–∞–π–ª: –ò–ù–°–¢–†–£–ö–¶–ò–Ø_–ó–ê–ì–†–£–ó–ö–ò.txt");
  console.log("\nüéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:");
  console.log('1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É "out/"');
  console.log("2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –í–°–ï —Ñ–∞–π–ª—ã –∏–∑ —ç—Ç–æ–π –ø–∞–ø–∫–∏ –Ω–∞ –≤–∞—à —Ö–æ—Å—Ç–∏–Ω–≥");
  console.log("3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ index.html –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –¥–æ–º–µ–Ω–∞");
} catch (error) {
  console.error("\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ —Å–∞–π—Ç–∞:", error.message);
  process.exit(1);
}
